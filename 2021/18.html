<body>
<script>
let start_time = performance.now();
//let inputs = ["[1,1]", "[2,2]", "[3,3]", "[4,4]", "[5,5]"];
//let inputs = ["[[[0,[5,8]],[[1,7],[9,6]]],[[4,[1,2]],[[1,4],2]]]", "[[[5,[2,8]],4],[5,[[9,9],0]]]", "[6,[[[6,2],[5,6]],[[7,6],[4,7]]]]", "[[[6,[0,7]],[0,9]],[4,[9,[9,0]]]]", "[[[7,[6,4]],[3,[1,3]]],[[[5,5],1],9]]", "[[6,[[7,3],[3,2]]],[[[3,8],[5,7]],4]]", "[[[[5,4],[7,7]],8],[[8,3],8]]", "[[9,3],[[9,9],[6,[4,9]]]]", "[[2,[[7,7],7]],[[5,8],[[9,3],[0,2]]]]", "[[[[5,2],5],[8,[3,7]]],[[5,[7,5]],[4,4]]]"];
let inputs = ["[[[3,9],[7,2]],[[8,4],[[5,6],0]]]", "[[[1,[4,9]],[[1,8],[1,5]]],[[[2,6],[6,7]],[[4,6],[9,0]]]]", "[[[[9,2],1],[[0,7],[9,6]]],[[5,9],[7,[6,9]]]]", "[8,9]", "[[4,[6,1]],[2,[[6,7],2]]]", "[[6,[[4,1],5]],[4,9]]", "[[[0,6],[8,[8,5]]],[6,9]]", "[[0,[1,0]],[[8,[7,4]],[[1,1],[5,0]]]]", "[[[1,[0,1]],6],[1,9]]", "[[2,[[9,0],[6,1]]],[[8,4],[5,7]]]", "[[[[5,3],[0,9]],[1,[0,7]]],[[9,0],[2,[2,0]]]]", "[[2,[2,[6,8]]],[[9,[5,4]],[4,[3,4]]]]", "[[[[4,0],[7,0]],[[4,8],[5,8]]],[[[7,2],[2,2]],[[3,3],3]]]", "[[5,0],5]", "[[8,[[5,0],2]],[6,[5,1]]]", "[[[9,[8,8]],[8,7]],[[[4,2],4],[[5,1],[4,8]]]]", "[[[[1,1],3],5],9]", "[[[[1,7],[6,5]],5],[[0,6],0]]", "[[9,6],2]", "[[[2,[0,8]],[8,[2,1]]],5]", "[[[9,[3,7]],3],[0,[5,9]]]", "[[[2,[1,7]],6],[[7,[8,2]],[[8,2],8]]]", "[[[[1,2],1],5],2]", "[4,[8,[3,9]]]", "[[[[8,9],[6,0]],[[1,6],7]],8]", "[[2,[8,1]],3]", "[[2,2],[[8,[0,2]],[[5,0],5]]]", "[9,[2,[[6,1],[8,9]]]]", "[[4,[[6,6],4]],[[[9,3],[3,1]],5]]", "[[[7,8],1],0]", "[[[8,8],[[1,0],7]],[4,6]]", "[9,8]", "[[[[4,2],9],[[9,9],7]],[7,[9,[5,8]]]]", "[[4,[4,[3,3]]],8]", "[0,2]", "[[4,[5,5]],[9,[[6,9],4]]]", "[[[7,3],[[1,2],6]],[[[2,4],[6,7]],[[5,0],9]]]", "[[[[2,0],5],[4,5]],[[[6,5],[6,0]],[1,[3,4]]]]", "[[3,[6,8]],[[[3,0],0],[[2,8],7]]]", "[[[4,[6,2]],[9,[4,1]]],[8,[3,4]]]", "[[[6,[6,8]],[7,[2,0]]],[4,[[8,7],[1,6]]]]", "[2,[0,[4,0]]]", "[[[[0,5],1],8],[[9,[0,3]],3]]", "[[[3,[5,2]],[3,[3,2]]],[[[7,3],1],7]]", "[1,[[[1,8],[1,7]],0]]", "[[8,6],[[0,4],4]]", "[[[8,2],[4,6]],3]", "[5,[[[7,5],[4,5]],[0,2]]]", "[[3,[3,6]],6]", "[[[[6,8],[5,7]],[[7,3],5]],[[8,[4,8]],8]]", "[[[[5,8],[3,1]],[[3,7],[7,0]]],[[9,7],0]]", "[[2,[[5,3],8]],0]", "[0,[2,8]]", "[[8,9],[[[2,2],[4,7]],[[4,0],1]]]", "[[[[3,0],8],[[7,3],[6,1]]],[[3,8],[4,2]]]", "[[[[6,7],[4,3]],[[3,9],5]],8]", "[[[7,7],[[3,4],7]],[[[0,4],1],9]]", "[[[7,5],5],[[2,[9,9]],[0,[3,5]]]]", "[[[[3,3],[6,1]],[5,8]],[[4,7],[8,1]]]", "[[[0,[7,3]],[6,[7,2]]],[[0,8],7]]", "[[[2,7],[9,7]],[8,[3,8]]]", "[[[0,2],6],[[9,[6,5]],[[3,9],1]]]", "[[7,[[3,4],[2,8]]],[[[4,1],4],7]]", "[[3,[[3,4],6]],[[3,9],[[4,5],[3,0]]]]", "[[[5,[5,1]],[2,4]],[1,[[1,6],6]]]", "[[[5,6],[[1,3],[5,0]]],[[[4,1],8],[5,5]]]", "[[[[2,0],7],[[8,9],1]],[[[4,0],[1,6]],1]]", "[[[2,0],[[4,2],[9,9]]],[4,9]]", "[[[[1,9],6],2],[[5,4],[2,4]]]", "[[[[4,1],[4,5]],[[2,3],2]],[3,[[8,8],1]]]", "[[[[8,1],0],[2,2]],[[2,[7,1]],1]]", "[[[7,4],[[1,3],5]],[[6,8],[[0,0],2]]]", "[[[1,2],8],[[[1,7],[4,0]],[[8,2],8]]]", "[[[0,8],[3,6]],[[[5,3],7],[9,7]]]", "[[4,6],[[[7,9],[7,5]],[[4,6],[8,4]]]]", "[[[[7,3],0],[[6,2],[7,2]]],[9,[[8,0],3]]]", "[[[3,0],1],[[2,3],1]]", "[[[5,[8,6]],[[1,2],2]],[[[1,4],6],[5,[7,1]]]]", "[[[[1,5],8],[0,0]],4]", "[[[7,[6,8]],3],[[5,1],[[2,8],[4,6]]]]", "[3,[[[5,8],[4,5]],[[7,7],8]]]", "[[6,[7,[8,2]]],[[9,0],0]]", "[[[8,[7,6]],1],[[2,4],6]]", "[[[[0,4],2],[0,7]],[6,6]]", "[1,[[1,9],[9,3]]]", "[[[[5,2],[5,3]],[[9,0],4]],2]", "[[[[5,5],3],[7,[1,2]]],[6,[7,2]]]", "[[[[2,1],3],8],[[2,[8,2]],[7,4]]]", "[[8,[9,[1,8]]],[[[4,4],[0,6]],[6,3]]]", "[[[1,6],[1,[2,5]]],0]", "[[[[0,1],[7,2]],[[7,2],3]],[2,[[7,8],[0,7]]]]", "[[[[1,8],8],[[5,7],[3,4]]],[[[2,5],[7,4]],[[8,4],9]]]", "[[[2,2],[5,[1,0]]],[[[6,6],[3,0]],[[8,5],5]]]", "[[[[8,2],[4,8]],[9,4]],[[8,[7,9]],0]]", "[[3,[5,[2,4]]],[[[8,1],0],[[0,4],[4,5]]]]", "[[5,[9,[3,8]]],[4,[1,[5,2]]]]", "[[[3,[0,6]],[7,[8,7]]],[[6,8],[[8,7],0]]]", "[[[[0,2],5],[4,6]],3]", "[[6,7],[[1,[4,6]],9]]", "[7,[3,[[8,8],5]]]"];

function convert(number) {
  let root;
  let curr;
  for (let n of number) {
    if (n == "[") {
      let next = {parent: curr};
      if (curr == undefined)
        root = next;
      else if (curr.left == undefined)
        curr.left = next;
      else
        curr.right = next;
      curr = next;
    } else if (n == ",") {
      continue;
    } else if (n == "]") {
      curr = curr.parent;
    } else {
      let val = parseInt(n);
      if (curr.left == undefined)
        curr.left = val;
      else
        curr.right = val;
    }
  }
  return root;
}

function addToNextLeft(curr, n) {
  while (curr.parent && curr.parent.left == curr)
    curr = curr.parent;
  if (!curr.parent)
    return;
  curr = curr.parent;
  if (Number.isInteger(curr.left)) {
    curr.left += n;
    return;
  }
  curr = curr.left;
  while (!Number.isInteger(curr.right)) curr = curr.right;
  curr.right += n;  
}

function addToNextRight(curr, n) {
  while (curr.parent && curr.parent.right == curr)
    curr = curr.parent;
  if (!curr.parent)
    return;
  curr = curr.parent;
  if (Number.isInteger(curr.right)) {
    curr.right += n;
    return;
  }
  curr = curr.right;
  while (!Number.isInteger(curr.left)) curr = curr.left;
  curr.left += n; 
}

function explode(curr, depth) {
  if (Number.isInteger(curr))
    return false;
  if (depth == 5) {
    addToNextLeft(curr, curr.left);
    addToNextRight(curr, curr.right);
    if (curr.parent.left == curr)
      curr.parent.left = 0;
    else
      curr.parent.right = 0;
    return true;
  }
  if (explode(curr.left, depth+1))
    return true;
  if (explode(curr.right, depth+1))
    return true;
  return false;
}

function split(curr) {
  if (!Number.isInteger(curr.left)) {
    if (split(curr.left)) return true;
  } else if (curr.left >= 10) {
    curr.left = { parent: curr, left: Math.floor(curr.left/2), right: Math.ceil(curr.left/2) };
    return true;
  }

  if (!Number.isInteger(curr.right)) {
    if (split(curr.right)) return true;
  } else if (curr.right >= 10) {
    curr.right = { parent: curr, left: Math.floor(curr.right/2), right: Math.ceil(curr.right/2) };
    return true;
  }
  return false;
}

function add(a, b) {
  let root = {left: a, right: b};
  a.parent = root;
  b.parent = root;
  while (true) {
    if (explode(root, 1))
      continue;
    if (split(root))
      continue;
    break;
  }
  return root;
}

function magnitude(curr) {
  if (Number.isInteger(curr))
    return curr;
  return 3*magnitude(curr.left) + 2*magnitude(curr.right);
}



function part1() {
  let numbers = [];
  for (let i of inputs)
    numbers.push(convert(i));
  let root = numbers[0];
  for (let i = 1; i < numbers.length; i++)
    root = add(root, numbers[i]);
  return magnitude(root);
}

function part2() {
  let max_magnitude = 0;
  for (let i = 0; i < inputs.length; i++) {
    for (let j = 0; j < inputs.length; j++) {
      if (i == j) continue;
      let mag = magnitude(add(convert(inputs[i]), convert(inputs[j])));
      if (mag > max_magnitude)
        max_magnitude = mag;
    }
  }
  return max_magnitude;
}

document.body.appendChild(document.createTextNode("Part 1: " + part1()));
document.body.appendChild(document.createElement("br"));
document.body.appendChild(document.createTextNode("Part 2: " + part2()));
document.body.appendChild(document.createElement("br"));
let runtime = performance.now() - start_time;
document.body.appendChild(document.createTextNode("Runtime: " + Math.round(runtime) + "ms"));
</script>
</body>