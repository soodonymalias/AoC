<body>
<script>
let real_input = ["Tile 1091:", "..#.##.##.", ".........#", "#.#......#", ".###..#...", "#.#.......", "##......##", "......#..#", "#.#....#..", "#...#....#", "#####....#", "", "Tile 3691:", "#.####..#.", "...##...#.", "##...#..#.", ".#....##.#", "#..#...#..", "#.##....##", "#.####....", "#..#.....#", ".##.#...##", "#.#.#.#..#", "", "Tile 2069:", "...####..#", ".#...#...#", "#...#....#", "...##..##.", ".#......##", ".#....##.#", "#..##.....", ".##...#..#", ".#....#...", "####....##", "", "Tile 2969:", "#...#.#.##", "#.#....#.#", ".......#.#", "#...#...#.", "#.....#.#.", "#.........", "..#...#..#", "...##..#.#", "#........#", "#.##...###", "", "Tile 3413:", "##.##..#.#", "#.#......#", "#.#.#.#...", ".#.......#", "..........", ".....###.#", "....#....#", "#...#.....", "..##.#..##", "..#.#..##.", "", "Tile 3943:", "..#####.##", "#.....#...", ".........#", "##.#.....#", "###.##....", ".##.....##", "#...#.....", "..#.#....#", "...#.....#", "...#.#.#..", "", "Tile 1163:", ".###..#.#.", "#..#.#...#", "#.........", "..#...#...", "....###..#", "....#..##.", ".......#..", "..#..#...#", "...####.#.", ".#########", "", "Tile 2179:", ".#.##.#.#.", "#.#...#.#.", "#...#...#.", "##.#..##..", ".###...##.", "#..#.#....", "..##.....#", "......##.#", "#...#...#.", ".##..##.##", "", "Tile 3539:", "#.##..#...", "#.....#...", "#.#......#", "#..##..##.", "####....##", ".#..#..#..", "#.#....#..", "#.....#..#", "#.#..#....", "####.#..##", "", "Tile 2749:", ".#....#.##", "#...#....#", "#...#.....", ".###.#.##.", "......##..", "..#.#.#...", "#.#..##..#", "##..#...##", "..####..#.", ".###..#.#.", "", "Tile 3701:", "...###...#", "..........", "..#.....#.", ".......#..", "#..#.#...#", "#......#..", "##.##.#.##", "........##", "......#..#", "#..#......", "", "Tile 3881:", "####..#..#", "#..#.....#", "#...##..#.", "#.....#...", "#..#..###.", "###.#.##..", "..##.#..#.", "##...#####", ".....#..#.", ".##....###", "", "Tile 3061:", "###...###.", ".....#...#", "#.........", "......#..#", ".#.......#", "#.....#...", ".......#.#", "#.......#.", "#.#..#.###", "..###.#...", "", "Tile 1861:", "#.#....#..", ".....#...#", "...#.###..", "##.......#", "..##.....#", "#...##...#", "..#.#.....", "#....#..#.", "###..#...#", "#.#..#.#.#", "", "Tile 2689:", "##..####.#", "#.###....#", "...#.#...#", ".....#.#.#", "...#.....#", "..##.....#", "#.##......", "#.#.#...##", ".........#", "..###.#.#.", "", "Tile 1693:", "#.#.####.#", "#.#.#....#", "#...###...", "..........", ".#..##.##.", "####....##", ".#......##", "..#.#.....", ".#.....#..", "###.###.#.", "", "Tile 3607:", "##..##.#..", "#...##....", "..#..##..#", ".....#...#", "....#..###", "##.......#", "#....#.##.", "....#.....", ".#....#.#.", ".##.#.####", "", "Tile 1879:", "#.#.###..#", "..........", ".#.#....##", "......#..#", "#.#..###..", "..#....###", "#..##.....", ".........#", "#......#..", ".###..#..#", "", "Tile 2027:", "##.#......", "#..##..#..", "..##..#...", "###.#....#", "..#.###...", "#..#......", "#.....##..", "#.##......", "#..#.#...#", "##....#...", "", "Tile 3727:", "####...#.#", "#.#.#.....", "##.......#", "......##.#", "..###.....", "...#..###.", ".#.#.##...", ".#..#..#.#", "#........#", ".##......#", "", "Tile 1451:", "..##.#...#", ".##.##....", ".....#....", "......##.#", ".........#", "...#.#....", "#.##.#...#", ".#..###...", "#...##....", "#.#..#..##", "", "Tile 1423:", "##....#...", "#...##....", "#...#..###", ".#.#...#.#", "#..#..#..#", "....#....#", ".#.#......", "...##.#.##", "#...##.#.#", "#.#...#..#", "", "Tile 2029:", "#.#...##..", "#........#", ".#.......#", "##.####.##", "#.#..#.#..", "..#.....#.", ".....#.###", "#.#......#", "..#...####", "..#...#..#", "", "Tile 1093:", "#...#..###", "##.......#", "..##...#.#", "#....#...#", "#.#.##..##", "##..##....", ".##..#.#..", "..#.....##", "......#.#.", "####.#.#..", "", "Tile 2393:", ".###..#...", "#..#...##.", ".#...#...#", "#.......#.", "##.#.....#", "##.##.#..#", "........##", "#..#.##..#", "..#....#..", "..#..#.###", "", "Tile 3299:", ".#.#.#.##.", ".#...#....", "#........#", "....####.#", ".#.....#..", "#.#.###..#", ".###.#.#..", "...#..####", "###.#.....", "####....#.", "", "Tile 2713:", ".#####.#.#", "#.##.#...#", "###...#...", ".#.....#.#", "##.....##.", "........##", "##.#..##..", "#.###...##", "#.#..#...#", "..#.###...", "", "Tile 2609:", "...#...##.", "#.....##..", "..#..#..#.", "##.#.##..#", "#..#.#....", "##..###.#.", ".#......##", "#..#.#.#..", "....#.....", "##.##.####", "", "Tile 3251:", ".#.###.##.", "...#.....#", "#.#.##...#", "#...#.#...", "##..#..#.#", "#.#.......", "#......#..", "#...#.#...", "##.#.#.#..", "#.#.#....#", "", "Tile 1697:", "...##.#...", "#.#....###", "#......#..", "..#...#.#.", ".#......#.", "#..##.#..#", "####...#.#", "##..##..#.", "#.#..#..##", "###.##....", "", "Tile 1399:", "#..##.#.##", "...#..#..#", "#....#....", ".#.......#", "#....##.##", "......##..", "......#..#", ".....##...", ".###...#.#", "..##.##...", "", "Tile 2897:", "#.#.###.##", "#.....#..#", "#.#...#.##", "#.#......#", "#..#..#..#", "..#..#...#", "#........#", "..####..#.", "##..#..#.#", ".###.###.#", "", "Tile 3163:", "#..#.#.#..", ".........#", "..........", "##...#.#..", "#........#", ".#...##..#", "#.##.#..##", "##..#.#...", "...#.....#", "........##", "", "Tile 2699:", ".#..##....", "...###....", "..#......#", "##.....#.#", ".#.##...#.", "##.......#", "........#.", "##..#.#...", "#.#.#.#...", "#..##..#.#", "", "Tile 2377:", ".##.#.#..#", "......#...", "#..#...###", ".......#.#", "...#.#...#", "#.....#...", "#..##...#.", ".#.....##.", "..##.....#", ".#.#....##", "", "Tile 2473:", "##.##.#.##", "#.#.....#.", ".....#...#", ".......##.", "#....#....", ".#.##...##", "#...#.....", ".........#", "........#.", ".#.####.##", "", "Tile 2447:", ".###.####.", ".......#..", ".#....#...", "#...#....#", "...#.#....", "#....#....", ".....##.##", ".....#...#", "##..#..#.#", ".#####..##", "", "Tile 2671:", "##..##..#.", "...#......", ".......#..", "..#..#...#", "....##.##.", "##.#...##.", "..#.......", "#....##...", "...##..#..", "###..###.#", "", "Tile 2333:", "#.#.###...", "#.#.#.....", "....##..#.", "#.....#..#", "##.......#", "#...#...#.", "..####...#", "...###....", ".#....#...", ".....#..##", "", "Tile 3329:", "#.##.###..", ".#..#...#.", "#...###.##", ".#...#.#..", "#.#...#...", "..#......#", "#.........", ".......#..", "##.#.#....", "##..##.#.#", "", "Tile 1301:", "#..#.##.#.", "##.......#", ".###...#..", "#.##......", "#...#.....", "........##", "#..#..##..", "...##....#", "........#.", "...#.####.", "", "Tile 2129:", "..#......#", "#...#...##", "...#.....#", ".#..##....", "#........#", ".........#", "..#....#..", "#......#.#", "##...#..#.", "#.#.#.#...", "", "Tile 3373:", "...##.##.#", "..#.....##", "#.#......#", ".#..#..#.#", "#.#.......", "##....#...", "..##......", "...#......", "#..##..#..", "#.#.#.#..#", "", "Tile 3527:", ".###.#..##", "......#..#", "##.#......", "....#.....", "#.##..#..#", "#..#..#..#", "#...##.#.#", "......#...", "#.#...#..#", "..##.....#", "", "Tile 1381:", "#...##..#.", ".#........", ".##..##.#.", "#.####....", "..#..#.###", ".####.##..", ".#.##.....", "......#..#", ".#....#.##", "#.###..#..", "", "Tile 3011:", "..#.##.##.", "...#.#...#", "..#.##.###", "........#.", "#........#", "..#.#.##.#", "##.#......", "#..##...##", "#...#...#.", "..##.....#", "", "Tile 2089:", ".###.###.#", "##.#.###..", "..##.#.###", "......#...", "....#..#.#", "#..#...#.#", "#.#..#..##", ".....#.###", "#...#....#", ".##..####.", "", "Tile 3371:", "###.......", "##..#..##.", ".........#", "##.....#.#", "##...#...#", "..........", ".....#..#.", ".......##.", ".....#...#", "...#.##.##", "", "Tile 2633:", "###..##...", "#.......#.", "#......##.", "...##.....", ".#..#....#", "#...###.##", "...##.....", "#...#....#", "#.###...#.", ".#####...#", "", "Tile 1597:", "#..#..#...", "#......#.#", ".....#....", "..........", "...#..#...", ".........#", ".#..#...#.", ".#.#......", "..........", ".##.#..###", "", "Tile 1361:", "#..##.###.", ".###..#...", "#..#......", "##.....#.#", "..#...#..#", ".#....##..", ".#...#..#.", "..#.....##", "..##....#.", "##.#.#..##", "", "Tile 2273:", ".......#.#", "#..#......", "#.....#..#", "......#..#", "#...##....", ".#..##....", "##.##....#", "......##..", "...#..#.##", "##.#.##...", "", "Tile 2297:", "#.#.#.....", "#.#.#..#.#", "##.##.#.##", "..........", "#.#..###.#", "##....#.##", "#......###", "....#..#.#", "#....#..##", "##..#.#.##", "", "Tile 3989:", "#.#...#...", "#.#####.#.", ".........#", "........##", "##..###...", "...##..#.#", "#..##..#..", "...#......", "......#..#", "..#.#..###", "", "Tile 1499:", ".###.##..#", "#..#.#..##", "...##...##", "#.....#.##", "#.#.#..#..", ".....#....", "#.#..#.#..", ".....#...#", "#..##.....", "#....####.", "", "Tile 1997:", "#....#.#..", "##.......#", ".#.......#", "#.###....#", "........#.", ".........#", "..#..##.##", "#..#......", "...###....", "##.#..#.#.", "", "Tile 3517:", "....#..###", "#........#", "#.........", "##..#....#", ".........#", "...#.....#", "..#.......", "#.###....#", "#.#..#...#", "..#.##.#.#", "", "Tile 1901:", "#.###....#", "#......#..", "#.....#...", "#......#..", ".#.....#.#", "###.#.....", "#.#....#.#", "#........#", "...#.#...#", "#####.....", "", "Tile 2417:", "##..#...#.", ".....#...#", ".##......#", "......#.##", ".........#", "#...#...#.", "#...#..#.#", ".......#.#", "###...#..#", "..#.###..#", "", "Tile 2311:", ".#..#.##..", "......##..", "#....#....", "......#.#.", ".#.#......", "#...#.##.#", "....#..#.#", "..#....###", "##...#.#.#", ".#.......#", "", "Tile 3671:", "#....#..##", "##...#.#.#", "#.....#..#", ".....#...#", "#....##.##", ".........#", "##...##..#", "#..##...##", ".##.###..#", "#.#...#...", "", "Tile 3391:", "##.##.##..", "#..#.##...", "####..#..#", "#..#.....#", ".#.#..##.#", "#.........", "#..#.##.##", "..##..###.", ".....#...#", "..#......#", "", "Tile 1783:", "##..#.#..#", ".#..##...#", "#.#....#.#", "....#...##", "........#.", "#..##.....", "#.##...#..", "##......##", "..#.#.#..#", "#.....###.", "", "Tile 3257:", "##.####...", ".#...#....", ".....#...#", "#...##.##.", "........##", "...#.####.", "......##.#", "..###....#", ".#.......#", "##.#..##.#", "", "Tile 1217:", "...##.#...", "....#...##", ".#..##....", ".........#", "####....#.", "##..#....#", "#.#.##...#", ".........#", "........##", "##...##.##", "", "Tile 1049:", "...#....#.", ".##......#", "..#...#...", ".#...#..#.", "##..#..###", "##..#..#..", "..#....##.", ".....#..#.", "#.........", ".####.#.#.", "", "Tile 3617:", ".#######.#", "##......##", ".#...#.###", "...##.....", "##........", "...#..#...", "#..#.....#", ".........#", ".......#.#", "##...#.##.", "", "Tile 1619:", "..###..##.", "#.....#...", "###....#.#", "..#..#....", "#..#.#..##", ".#.......#", "#.#.....##", "#......#.#", ".......#.#", "..#...#...", "", "Tile 1213:", "##..#.#..#", "#.#..###.#", "#.#...##.#", ".#...##..#", "#.#..#..##", ".#...#.###", "...#...#..", "#...#...##", "##.#...#..", ".#..##.#..", "", "Tile 3181:", "#######.##", "..#......#", "#.........", "....#.#.##", "......###.", "##...#...#", "....#.....", ".#.......#", ".#.......#", "#.##.#.#..", "", "Tile 1721:", "#.#.###...", "....#...#.", "....##.#..", "#...#.....", "..###.....", "#......#.#", "#...#....#", "#..#......", "..#..##..#", "##..##.##.", "", "Tile 2953:", "#.##.###..", ".........#", "..#....###", "..#.#...##", "...#..##.#", "#.....#..#", ".#...#....", ".......#.#", "#........#", "##...#..#.", "", "Tile 1459:", ".....#..##", "##...#..##", "......##..", "##.#...#.#", "...#......", "....#...##", "..##.....#", "#.#.##....", "...#......", "..#.##.#.#", "", "Tile 2683:", "###.#..#.#", "..#..#..##", "..#.#.#..#", "..#.......", "..#......#", "#....###.#", "........#.", "#...#....#", ".....#....", ".#..#.#.##", "", "Tile 3253:", ".#..#..#..", "...##....#", "..........", "##.#.....#", "##.....###", "....##...#", "....##...#", "..#.###.##", "#..#.##..#", "..###...##", "", "Tile 3947:", ".#..##.##.", "..#.......", "........##", "..##..#...", ".#.......#", "...#..#..#", ".#.#....##", "#..#..###.", ".....#.#..", "##.#.....#", "", "Tile 2887:", "#.....#.#.", "#...#...#.", ".#...#...#", ".........#", "##..#.....", "#.........", "..........", "#.#......#", "#......#.#", ".##......#", "", "Tile 2141:", "..#.#####.", "#.........", ".......#.#", "...#..#..#", ".#...##...", "##.##...##", "..#......#", ".##.##..#.", "#...##.#.#", "..##...#.#", "", "Tile 3793:", "#.##...#.#", "#..#..#.#.", "..#..#..##", "##.#....##", ".###.#....", "#....#...#", "#........#", "#....#..##", "#.......##", "#...###..#", "", "Tile 2213:", "#.####.#..", "..###...#.", "##..#.....", "..##..#..#", ".#..#..#..", "...#..#.#.", "....#.#...", "##..##...#", ".........#", "...#..#.#.", "", "Tile 3301:", "#..###.###", "##..###...", "#..##...##", "#........#", ".....#....", "#...###.#.", ".........#", "..........", "..#.#.#...", "#...#.#.#.", "", "Tile 3923:", ".#.###..#.", "........#.", "........##", "#......#..", "#.#..#...#", "#.#......#", "...#......", "##....#...", "#..#...#.#", "#..##...#.", "", "Tile 1747:", ".##.#.#.#.", ".#..#....#", "#.#####...", "#.....#..#", "..#.#....#", "..#.....#.", "#..#.#...#", "#.#.....##", "#......#.#", "..#...####", "", "Tile 2003:", "##..######", ".##..#.#..", ".#...#...#", "#.#.#..###", "#.#.#.....", "..#.###.##", "#..#....##", "#...#.#..#", "...#.....#", ".#####...#", "", "Tile 3559:", ".##..##...", "#.#.......", "....#..#.#", "..#......#", "#...#.....", "..........", "###...#...", "....#....#", ".#.###..##", "###...####", "", "Tile 1889:", "#.#....##.", "#....#...#", "#.#...#..#", ".......#..", "#....#.#.#", "....#....#", "#.##......", "#....#....", "#....#...#", "...##..#..", "", "Tile 2083:", "#..####...", ".......#.#", "#.#...#..#", "...##....#", "#.#.#....#", "#.......##", ".#...#...#", "..#.......", ".##.#.....", "#..#.#.#..", "", "Tile 2087:", "##.###.##.", ".........#", "...#.#..##", "#....#...#", "#.#..#.#..", "...#....#.", "#.........", "..#..#....", "...#......", "##.#..#.#.", "", "Tile 1523:", "....##.#.#", "...##.....", "#...#..#..", "#.#...##.#", "#........#", "#...#.##.#", "##....#...", "...##...#.", "#..#####..", "##...#.###", "", "Tile 1283:", "#######.#.", ".#.#......", ".#.......#", "#..#....#.", ".#..#...#.", "#.#..#..##", "#.........", "...#....#.", "#...#.....", ".####.###.", "", "Tile 3067:", "..####.#.#", "#.#....#.#", "#....##..#", ".....##..#", "##..#.....", "#.#...#.#.", "#.....#...", "...####...", "#.......#.", "#.#..##..#", "", "Tile 2267:", "#.....#...", "###.#...#.", "...##.....", "#..#..#..#", "......#...", "#..#.....#", "##..#....#", "#...#...#.", "...##....#", "###..##...", "", "Tile 2909:", "..#...#.##", ".....###..", "#........#", "#..#...#..", "#........#", ".........#", "#...#.##.#", "....#.....", "..#...#..#", "#..#.#...#", "", "Tile 3583:", ".#.#.####.", ".#..#..#.#", "##...##...", "......#...", ".#.###..##", "#....###.#", "#.##..#..#", "###..#.###", ".##..##...", "..#..#####", "", "Tile 2221:", ".##.###...", "..#..#....", "..........", "###......#", "#....#...#", "#...##....", "#....#...#", "###.#.#..#", "#...#.#..#", "..#..##.##", "", "Tile 2237:", "##..##.#.#", "#...#....#", "#.#......#", "#.#...#..#", "###..#.##.", "#.###...#.", "..##...#..", "...#.....#", "###.#.....", ".###.#..##", "", "Tile 1009:", "#.#.#..###", "#....#...#", "#.........", "...#.#...#", "..###.....", "#...#.....", "..........", "#.#...####", "..#.#..#.#", ".#.#.#.#..", "", "Tile 1831:", "..##.#..#.", "....#.#.#.", ".........#", ".#........", ".#..#.#.#.", "......#..#", "#.#.......", "...#......", "......#.#.", "##.###.#..", "", "Tile 2137:", "..##.#.#.#", "..##..#.##", ".#..#.....", "#..#.#...#", ".#...#..#.", ".#...#.###", "#.#...#..#", ".....#...#", "#......#..", ".#...#...#", "", "Tile 1669:", "..#..#.###", "#.##.###..", ".#........", ".#.....###", "#......#..", "###......#", "#..#.#....", "###...##.#", "#...#...##", "#......#.#", "", "Tile 2341:", ".###.#....", "#.........", "#..##.....", "#.#......#", "...#....#.", ".........#", "#.#.#.....", "......####", ".#.#....#.", ".#.###.#.#", "", "Tile 2243:", "...#...#..", "..#.#.#..#", "#....#....", "#....#....", "##...#....", "........##", "#.#...#..#", "..#......#", "#.....#...", "#####....#", "", "Tile 3319:", "..#####.#.", "....###.#.", "##...##...", ".###.#.#..", "...#..##..", "##.#..#..#", "...#...###", ".##...#.#.", "..##.##..#", "###.....#.", "", "Tile 3803:", ".##..####.", "#.##.....#", "###.....##", "###....##.", "##.#..#.#.", "#..###...#", "####..#.##", "...#......", "..#.......", "###..#####", "", "Tile 3217:", "#.###....#", ".#.......#", "..#.#...#.", ".....#..##", "..#......#", "#..#..#.#.", "#.........", ".......##.", "#........#", "##....#.#.", "", "Tile 2389:", "..#..###..", "..#....#..", "..##....#.", "..#......#", "#..##...##", "...#....##", "#.....##.#", "..........", ".....###.#", "##.##.##.#", "", "Tile 1367:", "#..##...#.", "##..##.##.", "#..#.....#", "##....#..#", ".#.#..#..#", "#.#..#..##", "##....##.#", "#...##.#.#", "..#.......", "..#.#.##.#", "", "Tile 3593:", ".##...##..", "......#.##", "..#.#.....", "..........", "##...#...#", ".#.#..#..#", "....##...#", "#.#......#", "..####...#", "####.####.", "", "Tile 2551:", "#..##..##.", "#.#..#...#", ".....#...#", "#..#.#..#.", ".....##.##", ".#....#...", "......#.##", "#....#.###", "#.#.#....#", ".#.###.##.", "", "Tile 3623:", ".#.###..##", ".#.#...#.#", "##...##...", "##...#...#", "....##....", "#...#..#..", ".#.....###", "#.##.....#", ".....#.#.#", "#.###..###", "", "Tile 1999:", "#.#..####.", "...##...#.", "#...#..#..", ".#..##..#.", "#.#.#.....", "....#.....", "......####", "#..#..##.#", ".#..##....", ".#...###.#", "", "Tile 3169:", ".#.#.###..", "........##", "#.........", "#.....#...", ".#.#..#.##", "#.........", "#####...#.", "...#....##", "......##..", ".#..#...##", "", "Tile 1951:", "##.#....#.", "#...##..#.", "##.#.##.#.", "#....#.#..", "#...#..#..", ".##..#...#", "...####...", "...###.##.", "#.#.......", "..#..#..##", "", "Tile 2617:", "#.##.#...#", ".#........", ".#.##....#", "#........#", ".#.#.#....", ".....#...#", "#.........", "#..####.#.", "......#..#", "###...#.##", "", "Tile 1559:", "##.#...#..", "#........#", ".#...#....", "#.........", "##..#.#.##", "......#...", ".#..#....#", ".....#....", "##.#.##...", "##.###.#..", "", "Tile 3407:", ".#..#####.", "##.#.#.#..", "#.....#.##", ".....##...", ".###.#...#", "...#.##...", ".##.....#.", "....##.#..", ".#..###.##", "..##.#..##", "", "Tile 3613:", "##...#.##.", "###......#", "......#.##", "#....#.###", "..###..#..", "#..#.....#", ".......##.", "..#.......", "....#.#..#", "#.#.##.##.", "", "Tile 2293:", "#..###..##", "#........#", "....#.#..#", "....#....#", "#..###...#", "#..#..#...", "#..#.##.##", "#.#...#..#", "##.......#", "..###.#..#", "", "Tile 2789:", "...#..####", "#...#.#..#", ".#.....#.#", "........##", ".....#..#.", "#####....#", "...#.#....", "#..##..#..", "......#..#", ".####.##..", "", "Tile 2857:", "#.#.#..#..", "##.#......", "..#......#", "#..####..#", "..#...#...", "....##...#", ".#........", "#..#.#...#", "#.......##", "##.#.#.#..", "", "Tile 3767:", "####.#..#.", ".....###.#", "....###.##", "#..##....#", "#..#....#.", "#.........", "....#.....", ".#.###.#..", "#...###..#", "###.###..#", "", "Tile 1531:", "##.#.#.#.#", "...#.....#", "..#.#..#.#", ".....#....", "....###.##", "....#.....", ".....#..##", "#.##.#..##", ".#..#.###.", "##.#.##.##", "", "Tile 3541:", "##..######", "..........", "..##.#....", ".#.#...#.#", "#.#.......", "#........#", ".........#", "#...#...#.", ".....#...#", "#.#..#.###", "", "Tile 2957:", "#.#.#..###", "#..#....##", ".#.......#", "...#..#..#", "..#.#....#", "##....#...", ".#....#...", "#####....#", ".####....#", ".#...#..##", "", "Tile 1249:", "####.##.##", "#...#..#.#", ".#..#....#", "#.#..#....", "#....#..#.", "##.......#", ".....#..#.", ".#..##.#..", "#...#....#", ".##.###...", "", "Tile 3931:", "#..###.##.", ".......###", "####.#.#.#", "#.......#.", "..#.#####.", "#..#..#.##", "....#..#..", "#.#....#..", ".#..#...#.", "#.....###.", "", "Tile 2731:", "#...#...##", "..##..#..#", "#.........", "##.##....#", "#........#", "#....#.###", "##.......#", "#..#.#...#", "....#.#...", ".##..#.###", "", "Tile 1609:", ".#...##.##", "#...#...#.", "#.##....#.", "#...#.....", ".#....#..#", "#.#......#", "..##.....#", "#......#..", "#.........", "#####..##.", "", "Tile 2579:", "#.###..#.#", ".##..#....", "...#.....#", "##.....#.#", ".#.#..#..#", "....##...#", "#...#..#.#", "#.....##..", "#..###...#", "..#.#..#.#", "", "Tile 1993:", ".#..##...#", "#...####..", "#......###", ".#.....###", "..#.#.....", "...#...#.#", "#.####..##", "#.........", "#....#.###", "####..#..#", "", "Tile 3229:", ".#.####.##", "##...#...#", "......#...", "#.....#.##", "..#...##..", "#...#.....", ".........#", "#....#.#.#", "...#.....#", "..########", "", "Tile 3469:", ".##....#.#", "#......###", ".#.#.....#", "#.#.##....", "#.##....##", "....#.#..#", "......#...", ".#.#.##...", ".#.#.##...", "#..######.", "", "Tile 3529:", ".#######..", "#..#.....#", "...###....", "....#.##.#", "..........", "...##.....", "###..#...#", "#..#.#..##", "#.........", "#..##.##.#", "", "Tile 2999:", "#...#..#.#", ".......#..", "...#......", ".##...#...", "##.#.....#", ".#...#....", ".##......#", ".#..##.#..", "##.#...#..", "##..#.####", "", "Tile 3853:", ".#.##.####", "#..#......", "..#.....##", ".####....#", "...#....#.", "##..#...#.", "##.....#..", "#..#.#....", "#.###.....", "##..####.#", "", "Tile 3917:", "#.#..#....", "..###.##..", "..##..#...", "..###.....", "...#......", ".........#", "##.#......", "..##.#....", "#.#.......", "#.##.##..#", "", "Tile 1489:", ".##....###", "#...#.....", "......#...", ".......###", "##..#..#..", "#..#....#.", "#...#.##..", "...#.....#", "##.#.#..#.", ".##.#.##.#", "", "Tile 1051:", "#....#.##.", ".##..#..#.", "...##....#", "#..#.#....", "#....#.#.#", ".........#", ".#.......#", ".#.##...#.", "#......#..", "####.###..", "", "Tile 2357:", "###.###...", "#.........", "...#...#.#", "...#......", ".#....#.##", "#.....#...", "#.#......#", "...#..##..", "..#..##.#.", "##..##..#.", "", "Tile 1709:", "..####.###", "#.........", "...#.#...#", "...#..#...", "#..####...", "....##....", "......#.#.", ".#...#....", "..##.#..##", "....#.#..#", "", "Tile 2753:", "...##.#..#", "###....###", "...#...##.", "###...#..#", "#...#.##.#", "#..#....#.", "#........#", "#...##....", "..#....###", ".#####.##.", "", "Tile 3863:", "#.##.#..##", "..#.#.#.#.", "#.......##", "##....##..", "..##......", "...###...#", "...#.#..##", "####.....#", "...#....##", "..###.#...", "", "Tile 1787:", "#.#...##.#", "..........", "...#.....#", "#...#.....", "...#......", "###.....##", "#.....##..", "..##......", "##.......#", "##.#...#.#", "", "Tile 1117:", "..##.#....", ".#...#.#..", "..#.#....#", "....#...#.", "#..##.#..#", "..#.#.....", "........#.", "#.#......#", "##.......#", "#.#..##..."];

let test_input = ["Tile 2311:", "..##.#..#.", "##..#.....", "#...##..#.", "####.#...#", "##.##.###.", "##...#.###", ".#.#.#..##", "..#....#..", "###...#.#.", "..###..###", "", "Tile 1951:", "#.##...##.", "#.####...#", ".....#..##", "#...######", ".##.#....#", ".###.#####", "###.##.##.", ".###....#.", "..#.#..#.#", "#...##.#..", "", "Tile 1171:", "####...##.", "#..##.#..#", "##.#..#.#.", ".###.####.", "..###.####", ".##....##.", ".#...####.", "#.##.####.", "####..#...", ".....##...", "", "Tile 1427:", "###.##.#..", ".#..#.##..", ".#.##.#..#", "#.#.#.##.#", "....#...##", "...##..##.", "...#.#####", ".#.####.#.", "..#..###.#", "..##.#..#.", "", "Tile 1489:", "##.#.#....", "..##...#..", ".##..##...", "..#...#...", "#####...#.", "#..#.#.#.#", "...#.#.#..", "##.#...##.", "..##.##.##", "###.##.#..", "", "Tile 2473:", "#....####.", "#..#.##...", "#.##..#...", "######.#.#", ".#...#.#.#", ".#########", ".###.#..#.", "########.#", "##...##.#.", "..###.#.#.", "", "Tile 2971:", "..#.#....#", "#...###...", "#.#.###...", "##.##..#..", ".#####..##", ".#..####.#", "#..#.#..#.", "..####.###", "..#.#.###.", "...#.#.#.#", "", "Tile 2729:", "...#.#.#.#", "####.#....", "..#.#.....", "....#..#.#", ".##..##.#.", ".#.####...", "####.#.#..", "##.####...", "##..#.##..", "#.##...##.", "", "Tile 3079:", "#.#.#####.", ".#..######", "..#.......", "######....", "####.#..#.", ".#...#.##.", "#.#####.##", "..#.###...", "..#.......", "..#.###..."];

function parseTiles(input) {
  let tiles = new Map();

  let tile = new Array();
  let tileId;
  for (line of input) {
    if (line == "") {
      tiles.set(tileId, tile);
      tile = new Array();
    } else if (line.startsWith("Tile")) {
      tileId = parseInt(line.substring(5, 9));
    } else {
      tile.push(line.split(""));
    }
  }
  tiles.set(tileId, tile);
  return tiles;
}

function addToSides(sides, side, tileId, sidesByTile) {
  let sideJoined = side.join();
  let curr = sides.get(sideJoined);
  if (curr == undefined)
    sides.set(sideJoined, new Array());
  sides.get(sideJoined).push(tileId);
  sidesByTile.get(tileId).push(sideJoined);
}

function getTop(tile) {
  return tile[0].slice(0, tile.length);
}

function getBottom(tile) {
  return tile[tile.length - 1].slice(0, tile.length);
}

function getLeft(tile) {
  let left = new Array();
  for (row of tile)
    left.push(row[0])
  return left;
}

function getRight(tile) {
  let right = new Array();
  for (row of tile)
    right.push(row[tile.length - 1]);
  return right;
}

let startCorner = -1;
let sides = new Map();
let sidesByTile = new Map();

function part1(tiles) {
  tiles.forEach((tile, id) => {
    sidesByTile.set(id, new Array());
    let top = getTop(tile);
    addToSides(sides, top, id, sidesByTile);
    addToSides(sides, top.reverse(), id, sidesByTile);

    let bottom = getBottom(tile);
    addToSides(sides, bottom, id, sidesByTile);
    addToSides(sides, bottom.reverse(), id, sidesByTile);

    let left = getLeft(tile);
    addToSides(sides, left, id, sidesByTile);
    addToSides(sides, left.reverse(), id, sidesByTile);

    let right = getRight(tile)
    addToSides(sides, right, id, sidesByTile);
    addToSides(sides, right.reverse(), id, sidesByTile);
    
  });
  let result = 1;
  sidesByTile.forEach((s, id) => {
    let unmatchedSides = 0;
    for (side of s) {
      if (sides.get(side).length == 1) unmatchedSides++;
    }
    if (unmatchedSides == 4) {
      result *= id;
      startCorner = id;
    }
  });
  return result;
}

function populate(picture, tile, x, y) {
  let startX = 8 * x;
  let startY = 8 * y;
  for (let i = 0; i < tile.length - 2; i++) {
    for (let j = 0; j < tile.length - 2; j++) {
      picture[startX + i][startY + j] = tile[i+1][j+1];
    }
  }
}

function rotate(tile) {
  let len = tile.length;
  for (let i = 0; i < len / 2; i++) {
    for (let j = 0; j < len / 2; j++) {
      let tmp = tile[i][j];
      tile[i][j] = tile[j][len-1-i];
      tile[j][len-1-i] = tile[len-1-i][len-1-j];
      tile[len-1-i][len-1-j] = tile[len-1-j][i];
      tile[len-1-j][i] = tmp;
    }
  }
}

function rotateUntilMatch(nextTile, toMatch, matchFunc) {
  for (let i = 0; i < 4; i++) {
    if (matchFunc(nextTile) == toMatch)
      return true;
    rotate(nextTile);
  }
  return false;
}

function flip(tile) {
  let len = tile.length;
  for (let i = 0; i < len; i++) {
    for (let j = 0; j < len / 2; j++) {
      let tmp = tile[i][j];
      tile[i][j] = tile[i][len-1-j];
      tile[i][len-1-j] = tmp
    }
  }
}

function isSeaMonster(picture, i, j) {
  if (picture[i][j+18] != '#') return false;
  if (picture[i+1][j] != '#' ||
      picture[i+1][j+5] != '#' ||
      picture[i+1][j+6] != '#' ||
      picture[i+1][j+11] != '#' ||
      picture[i+1][j+12] != '#' ||
      picture[i+1][j+17] != '#' ||
      picture[i+1][j+18] != '#' ||
      picture[i+1][j+19] != '#') {
    return false;
  }
  if (picture[i+2][j+1] != '#' ||
      picture[i+2][j+4] != '#' ||
      picture[i+2][j+7] != '#' ||
      picture[i+2][j+10] != '#' ||
      picture[i+2][j+13] != '#' ||
      picture[i+2][j+16] != '#') {
    return false;
  }
  return true;
}

function rotateUntilOriented(picture) {
  let len = picture.length;
  for (let i = 0; i < 4; i++) {
    for (let i = 0; i < len - 3; i++) {
      for (let j = 0; j < len - 20; j++) {
        if (isSeaMonster(picture, i, j)) return true;
      }
    }
    rotate(picture);
  }
  return false;
}

function part2(tiles) {
  let len = Math.sqrt(tiles.size);
  let picture = new Array(8 * len);
  for (let i = 0; i < picture.length; i++) {
    picture[i] = new Array(8 * len);
  }
  let tileCoords = new Array(len);
  for (let i = 0; i < tileCoords.length; i++) {
    tileCoords[i] = new Array(len);
  }

  let startTile = tiles.get(startCorner);
  for (let i = 0; i < 4; i++) {
    if (sides.get(getLeft(startTile).join()).length == 1 && sides.get(getTop(startTile).join()).length == 1) break;
    rotate(startTile);
  }
  tileCoords[0][0] = startCorner;
  populate(picture, startTile, 0, 0);

  for (let i = 1; i < len; i++) {
    let topNeighborId = tileCoords[i-1][0];
    let topNeighborBottom = getBottom(tiles.get(topNeighborId)).join();
    let pairedSides = sides.get(topNeighborBottom);
    tileCoords[i][0] = pairedSides[0] == topNeighborId ? pairedSides[1] : pairedSides[0];
    let nextTile = tiles.get(tileCoords[i][0]);

    let done = rotateUntilMatch(nextTile, topNeighborBottom, getTop);
    if (!done) {
      flip(nextTile);
      done = rotateUntilMatch(nextTile, topNeighborBottom, getTop);
    }
    populate(picture, nextTile, i, 0);
  }
  for (let i = 0; i < len; i++) {
    for (let j = 1; j < len; j++) {
      let leftNeighborId = tileCoords[i][j-1];
      let leftNeighborRight = getRight(tiles.get(leftNeighborId)).join();
      let pairedSides = sides.get(leftNeighborRight);
      tileCoords[i][j] = pairedSides[0] == leftNeighborId ? pairedSides[1] : pairedSides[0];
      let nextTile = tiles.get(tileCoords[i][j]);

      let done = rotateUntilMatch(nextTile, leftNeighborRight, getLeft);
      if (!done) {
        flip(nextTile);
        done = rotateUntilMatch(nextTile, leftNeighborRight, getLeft);
      }
      populate(picture, nextTile, i, j);
    }
  }

  let oriented = rotateUntilOriented(picture);
  if (!oriented) {
    flip(picture);
    oriented = rotateUntilOriented(picture);
  }

  let monsterCount = 0;
  for (let i = 0; i < picture.length - 3; i++) {
    for (let j = 0; j < picture.length - 20; j++) {
      if (isSeaMonster(picture, i, j)) monsterCount++;
    }
  }
  let hashCount = 0;
  for (let i = 0; i < picture.length; i++) {
    for (let j = 0; j < picture.length; j++) {
      if (picture[i][j] == '#') hashCount++;
    }
  }
  return hashCount - (monsterCount * 15);
}

window.onload = () => {
  let start_time = performance.now();
  let input = real_input;

  let tiles = parseTiles(input);

  document.body.appendChild(document.createTextNode("Part one: " + part1(tiles)));
  document.body.appendChild(document.createElement("br"));

  document.body.appendChild(document.createTextNode("Part two: " + part2(tiles)));
  document.body.appendChild(document.createElement("br"));

  let runtime = performance.now() - start_time;
  document.body.appendChild(document.createTextNode("Runtime: " + runtime + "ms"));
}
</script>
</body>